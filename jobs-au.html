<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>AU Tech Jobs — Microsoft Learn Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#0b1220;            /* page background */
    --surface:#0e1629;       /* header/controls surface */
    --card:#0f172a;          /* card background */
    --border:#22314b;        /* subtle borders */
    --text:#e9eef7;          /* primary text */
    --muted:#a9b4c6;         /* secondary text */
    --link:#9cc4ff;          /* link / focus */
    --accent-1:#4f8cff;      /* gradient left */
    --accent-2:#8b5cf6;      /* gradient right */
    --ok:#23d18b; --warn:#ffd27a; --err:#ff9b9b;
    --radius-lg:14px; --radius-md:12px; --radius-sm:10px;
    --shadow:0 6px 20px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,rgba(79,140,255,.12),transparent 60%),radial-gradient(900px 500px at 100% 0,rgba(139,92,246,.10),transparent 60%),var(--bg);color:var(--text);font:16px/1.55 system-ui,"Segoe UI",Inter,Roboto,Arial}
  a{color:var(--link);text-decoration:none}
  a:hover{text-decoration:underline}

  /* Header */
  header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,var(--surface),rgba(14,22,41,.92));backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1160px;margin:0 auto;padding:18px 16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));box-shadow:inset 0 0 0 1px rgba(255,255,255,.18)}
  h1{margin:0;font-size:20px;font-weight:700}
  .sub{margin:2px 0 0;font-size:13px;color:var(--muted)}
  .bar{height:3px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));border-radius:3px}

  /* Controls */
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
  .select,.input,.btn{appearance:none;background:var(--card);border:1px solid var(--border);color:var(--text);border-radius:var(--radius-sm);padding:10px 12px}
  .select,.input{min-height:40px}
  .input{width:320px;max-width:100%}
  .btn{cursor:pointer;user-select:none;font-weight:600;box-shadow:0 1px 0 rgba(255,255,255,.04) inset}
  .btn:hover{border-color:#2b3f60}
  .btn-primary{background:linear-gradient(180deg,#1b2c4a,#12223f);border-color:#2b3f60}
  .btn-ghost{background:transparent}
  .chiprow{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .chip{font-size:12px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:rgba(255,255,255,.03);cursor:pointer}
  .chip.active{border-color:#4566a3;background:rgba(156,196,255,.12)}

  /* Main */
  main .wrap{padding-top:16px}
  .status{margin:8px 0 6px;padding:10px 12px;border:1px solid var(--border);background:rgba(255,255,255,.03);border-radius:var(--radius-md);font-size:14px;display:flex;align-items:center;gap:10px}
  .status[aria-live]{
    /* ensure screenreaders announce changes */
  }
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  .spinner{width:22px;height:22px;border:3px solid #2a3a56;border-top-color:var(--link);border-radius:50%;animation:spin 1s linear infinite;display:inline-block}
  @keyframes spin{to{transform:rotate(360deg)}}

  details.diag{margin-top:10px;border:1px dashed var(--border);border-radius:var(--radius-md);padding:8px 10px;background:rgba(255,255,255,.02)}
  details.diag summary{cursor:pointer;color:var(--muted)}
  pre{white-space:pre-wrap;margin:8px 0 0;font-size:12px;color:var(--muted)}

  .toolbar{display:flex;align-items:center;gap:10px;margin-top:8px}
  .muted{color:var(--muted);font-size:13px}

  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:14px;margin-top:14px}
  .card{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.00));border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px;box-shadow:var(--shadow);transition:transform .15s ease, border-color .15s ease}
  .card:hover{transform:translateY(-1px);border-color:#3c5687}
  .meta{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted)}
  .provider{padding:4px 8px;border:1px solid var(--border);border-radius:999px;background:rgba(156,196,255,.10);font-weight:600;letter-spacing:.2px}
  .title{margin:8px 0 6px;font-size:17px;line-height:1.3}
  .company{font-weight:600}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;border:1px solid var(--border);font-size:11px;color:var(--muted)}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

  /* Skeletons */
  .skeleton{position:relative;overflow:hidden}
  .skeleton::before{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.05),transparent);animation:shimmer 1.2s infinite}
  @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
  .sk-line{height:12px;background:#101a30;border-radius:6px}
  .sk-title{height:16px;margin:12px 0 8px}
  .sk-meta{height:10px;margin-top:8px;width:60%}

  /* Accessibility helpers */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Australia • AI / Data / Security / Software / Cloud — Jobs</h1>
          <p class="sub">Polished, Microsoft Learn–inspired UI. Uses your Worker API with zero external libraries.</p>
        </div>
      </div>
      <div class="bar" aria-hidden="true"></div>
      <div class="controls" role="search">
        <select id="preset" class="select" aria-label="Preset filters">
          <option value="">All tech roles (default)</option>
          <option value="AI,Machine Learning,Deep Learning,GenAI,ML">AI &amp; ML</option>
          <option value="Big Data,Data Engineer,Data Scientist">Big Data</option>
          <option value="Cybersecurity,Security Engineer,SOC,AppSec,Infosec">Cybersecurity</option>
          <option value="Software Engineer,Backend,Frontend,Full Stack">Software Engineering</option>
          <option value="Cloud,AWS,GCP,Azure,DevOps,SRE,Kubernetes">Cloud &amp; Platform</option>
        </select>
        <input id="search" class="input" placeholder="Optional extra keywords (comma separated)" aria-label="Extra keywords" />
        <select id="sort" class="select" aria-label="Sort results">
          <option value="date-desc">Newest first</option>
          <option value="date-asc">Oldest first</option>
          <option value="company-asc">Company A→Z</option>
          <option value="company-desc">Company Z→A</option>
        </select>
        <button id="go" class="btn btn-primary">Refresh</button>
        <button id="reset" class="btn btn-ghost" title="Clear filters">Reset</button>
      </div>
      <div class="chiprow" aria-label="Quick categories">
        <button class="chip" data-q="AI,Machine Learning,Deep Learning,GenAI,ML">AI</button>
        <button class="chip" data-q="Cybersecurity,SOC,AppSec,Infosec">Cyber</button>
        <button class="chip" data-q="Data Engineer,Big Data,Data Scientist">Data</button>
        <button class="chip" data-q="Cloud,AWS,GCP,Azure,DevOps,SRE,Kubernetes">Cloud</button>
        <button class="chip" data-q="Software Engineer,Backend,Frontend,Full Stack">Software</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="status" class="status" aria-live="polite"><span class="spinner" aria-hidden="true"></span> Ready. Click Refresh to fetch.</div>
      <div class="toolbar">
        <div class="muted" id="summary"></div>
      </div>
      <details class="diag">
        <summary>Diagnostics</summary>
        <pre id="diag"></pre>
      </details>
      <div id="grid" class="grid" aria-live="polite"></div>
    </div>
  </main>

<script>
// ====== SET THIS EXACTLY ======
const WORKER_BASE = "https://rss-proxy.yasirkaleem.workers.dev"; // no trailing slash
const PROVIDERS   = "careerjet,lever,greenhouse,ashby";           // customize anytime
// ==============================

const $preset = document.getElementById("preset");
const $search = document.getElementById("search");
const $go = document.getElementById("go");
const $reset = document.getElementById("reset");
const $sort = document.getElementById("sort");
const $status = document.getElementById("status");
const $diag = document.getElementById("diag");
const $grid = document.getElementById("grid");
const $summary = document.getElementById("summary");
const $chips = Array.from(document.querySelectorAll('.chip'));

$go.addEventListener("click", load);
$reset.addEventListener("click", () => { $preset.value = ""; $search.value = ""; $sort.value = "date-desc"; setActiveChip(null); load(); });
$sort.addEventListener("change", load);
$search.addEventListener("keydown", e => { if (e.key === "Enter") load(); });
$chips.forEach(ch => ch.addEventListener('click', () => { $preset.value = ch.dataset.q; setActiveChip(ch); load(); }));
window.addEventListener("load", load);

function setActiveChip(active){
  $chips.forEach(c => c.classList.toggle('active', c === active));
}

function buildUrl(){
  const parts = [];
  if ($preset.value) parts.push($preset.value);
  if ($search.value.trim()) parts.push($search.value.trim());
  const q = parts.join(",");
  const cb = Date.now(); // cache-buster
  return `${WORKER_BASE}/jobs-au?providers=${encodeURIComponent(PROVIDERS)}${q?`&q=${encodeURIComponent(q)}`:""}&cb=${cb}`;
}

function renderSkeleton(count=6){
  $grid.innerHTML = "";
  for(let i=0;i<count;i++){
    const c = document.createElement('div');
    c.className = 'card skeleton';
    c.innerHTML = `
      <div class="row"><div class="provider sk-line" style="width:90px;height:20px"></div></div>
      <div class="sk-title sk-line"></div>
      <div class="row" style="gap:8px">
        <div class="sk-line" style="width:40%"></div>
        <div class="sk-line" style="width:25%"></div>
      </div>
      <div class="sk-meta sk-line"></div>
    `;
    $grid.appendChild(c);
  }
}

function timeAgo(dateStr){
  if(!dateStr) return "";
  const d = new Date(dateStr);
  if(isNaN(d)) return new Date(dateStr).toLocaleDateString('en-AU');
  const diff = Date.now() - d.getTime();
  const mins = Math.floor(diff/60000);
  if(mins < 60) return `${mins}m ago`;
  const hrs = Math.floor(mins/60);
  if(hrs < 24) return `${hrs}h ago`;
  const days = Math.floor(hrs/24);
  if(days < 7) return `${days}d ago`;
  return d.toLocaleDateString('en-AU');
}

function sortItems(items){
  const [key, dir] = $sort.value.split('-');
  const mod = dir === 'desc' ? -1 : 1;
  return items.slice().sort((a,b)=>{
    if(key === 'date'){
      const da = new Date(a.date||0).getTime();
      const db = new Date(b.date||0).getTime();
      return da < db ? mod : da > db ? -mod : 0;
    }
    if(key === 'company'){
      const ca = (a.company||'').toLowerCase();
      const cb = (b.company||'').toLowerCase();
      return ca < cb ? -mod : ca > cb ? mod : 0;
    }
    return 0;
  });
}

async function load(){
  $status.innerHTML = `<span class="spinner" aria-hidden="true"></span> Fetching…`;
  $diag.textContent = '';
  $summary.textContent = '';
  renderSkeleton(8);

  const url = buildUrl();
  try{
    const r = await fetch(url, { cache:"no-store" });
    const text = await r.text();
    let data;
    try { data = JSON.parse(text); } catch(e){ data = null; }

    // ---- Diagnostics panel ----
    const lines = [];
    lines.push(`Request: ${url}`);
    lines.push(`HTTP: ${r.status}`);
    lines.push(`Content-Type: ${r.headers.get('content-type') || '(none)'}`);
    if (data) {
      const shape = Array.isArray(data) ? 'Array' : (data && typeof data === 'object' ? 'Object' : typeof data);
      lines.push(`JSON shape: ${shape} ${Array.isArray(data) ? `(length=${data.length})` : (data.items ? `(items.length=${(data.items||[]).length})` : '')}`);
    } else {
      lines.push('JSON parse: FAILED — showing raw body below');
      lines.push(text.slice(0, 800));
    }
    $diag.textContent = lines.join('\n');

    if (!data) {
      $status.innerHTML = `<span class="err">Couldn’t parse JSON from Worker.</span>`;
      $grid.innerHTML = '';
      return;
    }

    // ---- Accept BOTH shapes: [ ... ] OR { items:[ ... ] }
    let items = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);
    if (!items.length) {
      $status.innerHTML = `<span class="warn">No jobs returned. If HTTP is 200, try changing preset/keywords.</span>`;
      $grid.innerHTML = '';
      return;
    }

    items = sortItems(items);

    $grid.innerHTML = '';
    const count = items.length;
    const terms = [$preset.value ? 'Preset' : null, $search.value.trim() ? 'Keywords' : null].filter(Boolean).join(' + ');
    $summary.textContent = `${count} job${count!==1?'s':''} ${terms ? '• ' + terms : ''}`;
    $status.innerHTML = `<span class="ok">Loaded ${count} job${count!==1?'s':''}.</span>`;

    for (const j of items){
      const card = document.createElement('div');
      card.className = 'card';
      const provider = (j.provider||'').toUpperCase();
      const url = escapeHTML(j.url||'');
      const title = escapeHTML(j.title||'');
      const company = escapeHTML(j.company||'');
      const location = escapeHTML(j.location||'Australia');
      const when = j.date ? timeAgo(j.date) : '';

      card.innerHTML = `
        <div class="meta"><span class="provider">${provider||'JOB'}</span></div>
        <h3 class="title"><a href="${url}" target="_blank" rel="noopener">${title}</a></h3>
        <div class="row">
          <span class="company">${company}</span>
          <span class="muted">•</span>
          <span class="muted">${location}</span>
        </div>
        <div class="row" style="margin-top:8px">
          ${when ? `<span class="pill" title="Published">${when}</span>` : ''}
        </div>
      `;
      $grid.appendChild(card);
    }
  }catch(e){
    $status.innerHTML = `<span class="err">Fetch failed: ${escapeHTML(e.message)}</span>`;
    $grid.innerHTML = '';
  }
}

function escapeHTML(s){return (s||"").replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
</script>
</body>
</html>

