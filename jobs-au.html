<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>AU Tech Jobs — IAT Digital</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Early theme/embed/auto boot (runs before CSS to avoid flash) -->
<script>
(function(){
  try{
    var q = new URLSearchParams(location.search);
    var theme = q.get("theme");           // "light" | "dark"
    var embed = q.get("embed");           // "1" to compact for iframes
    var auto  = q.get("auto");            // "1" or "0"
    var iv    = q.get("interval");        // ms, e.g. 300000

    if (theme) localStorage.setItem("jobs_theme", theme);
    var savedTheme = theme || localStorage.getItem("jobs_theme") || "light";
    document.documentElement.setAttribute("data-theme", savedTheme === "dark" ? "dark" : "light");

    if (embed === "1") document.documentElement.setAttribute("data-embed","1");
    if (iv)  localStorage.setItem("jobs_auto_iv", iv);
    if (auto === "1" || auto === "0") localStorage.setItem("jobs_auto_on", auto);
  }catch(e){}
})();
</script>

<style>
  :root{
    /* Light theme (default) */
    --bg:#f7f9fc; --surface:#ffffff; --card:#ffffff; --border:#e6e9ef;
    --text:#111827; --muted:#6b7280; --link:#2563eb;
    --accent-1:#60a5fa; --accent-2:#a78bfa;
    --ok:#059669; --warn:#b45309; --err:#b91c1c;
    --radius-lg:14px; --radius-md:12px; --radius-sm:10px;
    --shadow:0 6px 20px rgba(17,24,39,.06);
    --ring: 0 0 0 3px rgba(37,99,235,.15);
  }
  [data-theme="dark"]{
    --bg:#0b1220; --surface:#0e1629; --card:#0f172a; --border:#22314b;
    --text:#e9eef7; --muted:#a9b4c6; --link:#9cc4ff;
    --accent-1:#4f8cff; --accent-2:#8b5cf6;
    --ok:#23d18b; --warn:#ffd27a; --err:#ff9b9b;
    --shadow:0 6px 20px rgba(0,0,0,.25);
    --ring: 0 0 0 3px rgba(156,196,255,.20);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1200px 600px at 20% -10%,rgba(96,165,250,.18),transparent 60%),
      radial-gradient(900px 500px at 100% 0,rgba(167,139,250,.16),transparent 60%),
      var(--bg);
    color:var(--text);
    font:16px/1.55 system-ui,"Segoe UI",Inter,Roboto,Arial;
  }
  [data-theme="dark"] body{
    background:
      radial-gradient(1200px 600px at 20% -10%,rgba(79,140,255,.12),transparent 60%),
      radial-gradient(900px 500px at 100% 0,rgba(139,92,246,.10),transparent 60%),
      var(--bg);
  }
  a{color:var(--link);text-decoration:none}
  a:hover{text-decoration:underline}

  /* Header */
  header{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(180deg,var(--surface),rgba(255,255,255,.92));
    border-bottom:1px solid var(--border);
    backdrop-filter:saturate(130%) blur(6px);
  }
  [data-theme="dark"] header{
    background:linear-gradient(180deg,var(--surface),rgba(14,22,41,.92));
  }
  /* Compact header for embeds */
  [data-embed] header{ position:static; backdrop-filter:none; }
  [data-embed] .wrap{ padding:12px 12px; }
  [data-embed] .bar{ display:none; }

  .wrap{max-width:1160px;margin:0 auto;padding:18px 16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{
    width:28px;height:28px;border-radius:8px;
    background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.8)
  }
  h1{margin:0;font-size:20px;font-weight:800;letter-spacing:.2px}
  .sub{margin:6px 0 0;font-size:13px;color:var(--muted)}
  .bar{height:3px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));border-radius:3px}

  /* Controls */
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
  .select,.input,.btn{
    appearance:none;background:var(--surface);
    border:1px solid var(--border);color:var(--text);
    border-radius:var(--radius-sm);padding:10px 12px;
    box-shadow:0 1px 0 rgba(17,24,39,.025) inset;
  }
  .select:focus,.input:focus,.btn:focus{outline:0;box-shadow:var(--ring)}
  .select,.input{min-height:40px}
  .input{width:320px;max-width:100%}
  .btn{cursor:pointer;user-select:none;font-weight:600}
  .btn:hover{border-color:#d8deea}
  [data-theme="dark"] .btn:hover{border-color:#2b3f60}
  .btn-primary{
    background:linear-gradient(180deg,#3b82f6,#2563eb);
    border-color:#1d4ed8;color:#fff;box-shadow:var(--shadow)
  }
  .btn-ghost{background:var(--surface)}
  .chiprow{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .chip{
    font-size:12px;padding:6px 10px;border:1px solid var(--border);
    border-radius:999px;background:var(--surface);cursor:pointer;color:inherit
  }
  .chip.active{border-color:#bfdbfe;background:#eff6ff;color:#1e3a8a}
  [data-theme="dark"] .chip.active{border-color:#4566a3;background:rgba(156,196,255,.12);color:var(--text)}

  /* Toolbar (summary + toggles) */
  .toolbar{display:flex;align-items:center;gap:12px;margin-top:8px;flex-wrap:wrap}
  .muted{color:var(--muted);font-size:13px}
  .toggle{display:inline-flex;align-items:center;gap:6px;font-size:13px;color:var(--muted)}
  .toggle input{accent-color:#2563eb;width:16px;height:16px}

  /* Main */
  main .wrap{padding-top:16px}
  .status{
    margin:8px 0 6px;padding:10px 12px;border:1px solid var(--border);
    background:var(--surface);border-radius:var(--radius-md);font-size:14px;
    display:flex;align-items:center;gap:10px
  }
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  .spinner{
    width:20px;height:20px;border:3px solid #dbe5f0;border-top-color:var(--link);
    border-radius:50%;animation:spin 1s linear infinite;display:inline-block
  }
  [data-theme="dark"] .spinner{border-color:#2a3a56;border-top-color:var(--link)}
  @keyframes spin{to{transform:rotate(360deg)}}

  details.diag{
    margin-top:10px;border:1px dashed var(--border);
    border-radius:var(--radius-md);padding:8px 10px;background:var(--surface)
  }
  details.diag summary{cursor:pointer;color:var(--muted)}
  pre{white-space:pre-wrap;margin:8px 0 0;font-size:12px;color:#4b5563}
  [data-theme="dark"] pre{color:var(--muted)}

  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:14px;margin-top:14px}
  .card{
    position:relative;background:var(--card);border:1px solid var(--border);
    border-radius:var(--radius-lg);padding:14px;box-shadow:var(--shadow);
    transition:transform .15s ease, border-color .15s ease
  }
  .card:hover{transform:translateY(-1px);border-color:#d3daf0}
  [data-theme="dark"] .card:hover{border-color:#3c5687}
  .meta{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted)}
  .provider{
    padding:4px 8px;border:1px solid var(--border);border-radius:999px;
    background:#eff6ff;color:#1e3a8a;font-weight:700;letter-spacing:.2px
  }
  [data-theme="dark"] .provider{background:rgba(156,196,255,.10);color:#d6e5ff}
  .title{margin:8px 0 6px;font-size:17px;line-height:1.3}
  .company{font-weight:700}
  .pill{
    display:inline-flex;align-items:center;gap:6px;padding:3px 8px;
    border-radius:999px;border:1px solid var(--border);font-size:11px;color:inherit;background:var(--surface)
  }
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

  /* Skeletons */
  .skeleton{position:relative;overflow:hidden;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px}
  .skeleton::before{
    content:"";position:absolute;inset:0;
    background:linear-gradient(90deg,transparent,rgba(17,24,39,.05),transparent);
    animation:shimmer 1.2s infinite
  }
  @keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
  .sk-line{height:12px;background:#eef2f7;border-radius:6px}
  .sk-title{height:16px;margin:12px 0 8px}
  .sk-meta{height:10px;margin-top:8px;width:60%}

  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Australia • AI / Data / Security / Software / Cloud — Jobs</h1>
          <p class="sub">
            <strong>Disclaimer:</strong>
            These are aggregated job advertisements from third-party sources. IAT Digital does not endorse, vet, or guarantee any role, listing accuracy, or availability. Do your own due diligence and use discretion when applying or sharing personal information.
          </p>
        </div>
      </div>
      <div class="bar" aria-hidden="true"></div>

      <div class="controls" role="search">
        <select id="preset" class="select" aria-label="Preset filters">
          <option value="">All tech roles (default)</option>
          <option value="AI,Machine Learning,Deep Learning,GenAI,ML">AI &amp; ML</option>
          <option value="Big Data,Data Engineer,Data Scientist">Big Data</option>
          <option value="Cybersecurity,Security Engineer,SOC,AppSec,Infosec">Cybersecurity</option>
          <option value="Software Engineer,Backend,Frontend,Full Stack">Software Engineering</option>
          <option value="Cloud,AWS,GCP,Azure,DevOps,SRE,Kubernetes">Cloud &amp; Platform</option>
        </select>

        <input id="search" class="input" placeholder="Optional extra keywords (comma separated)" aria-label="Extra keywords" />

        <select id="sort" class="select" aria-label="Sort results">
          <option value="date-desc">Newest first</option>
          <option value="date-asc">Oldest first</option>
          <option value="company-asc">Company A→Z</option>
          <option value="company-desc">Company Z→A</option>
        </select>

        <button id="go" class="btn btn-primary">Refresh</button>
        <button id="reset" class="btn btn-ghost" title="Clear filters">Reset</button>
      </div>

      <div class="chiprow" aria-label="Quick categories">
        <button class="chip" data-q="AI,Machine Learning,Deep Learning,GenAI,ML">AI</button>
        <button class="chip" data-q="Cybersecurity,SOC,AppSec,Infosec">Cyber</button>
        <button class="chip" data-q="Data Engineer,Big Data,Data Scientist">Data</button>
        <button class="chip" data-q="Cloud,AWS,GCP,Azure,DevOps,SRE,Kubernetes">Cloud</button>
        <button class="chip" data-q="Software Engineer,Backend,Frontend,Full Stack">Software</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="status" class="status" aria-live="polite">Ready. Click Refresh to fetch.</div>

      <div class="toolbar">
        <div class="muted" id="summary"></div>
        <span class="toggle"><input type="checkbox" id="themeToggle"> Dark mode</span>
        <span class="toggle"><input type="checkbox" id="autoToggle"> Auto refresh</span>
        <select id="interval" class="select" aria-label="Auto refresh interval" style="min-width:160px">
          <option value="60000">Every 1 minute</option>
          <option value="300000" selected>Every 5 minutes</option>
          <option value="900000">Every 15 minutes</option>
        </select>
        <span class="muted" id="lastRef"></span>
      </div>

      <details class="diag">
        <summary>Diagnostics</summary>
        <pre id="diag"></pre>
      </details>

      <div id="grid" class="grid" aria-live="polite"></div>
    </div>
  </main>

<script>
/* ====== CONFIG ====== */
const WORKER_BASE = "https://rss-proxy.yasirkaleem.workers.dev"; // no trailing slash
const PROVIDERS   = "careerjet,adzuna,lever,greenhouse,ashby";    // volume + direct boards
/* ==================== */

const $preset   = document.getElementById("preset");
const $search   = document.getElementById("search");
const $go       = document.getElementById("go");
const $reset    = document.getElementById("reset");
const $sort     = document.getElementById("sort");
const $status   = document.getElementById("status");
const $diag     = document.getElementById("diag");
const $grid     = document.getElementById("grid");
const $summary  = document.getElementById("summary");
const $chips    = Array.from(document.querySelectorAll('.chip'));
const $themeTgl = document.getElementById("themeToggle");
const $autoTgl  = document.getElementById("autoToggle");
const $interval = document.getElementById("interval");
const $lastRef  = document.getElementById("lastRef");

let autoTimer = null;
let isLoading = false;

/* ---- Theme ---- */
(function initTheme(){
  const mode = document.documentElement.getAttribute("data-theme") || "light";
  $themeTgl.checked = (mode === "dark");
})();
$themeTgl.addEventListener("change", ()=>{
  const mode = $themeTgl.checked ? "dark" : "light";
  document.documentElement.setAttribute("data-theme", mode);
  localStorage.setItem("jobs_theme", mode);
});

/* ---- Auto refresh ---- */
(function initAuto(){
  const savedIv = localStorage.getItem("jobs_auto_iv");
  if (savedIv) $interval.value = String(savedIv);
  const savedOn = localStorage.getItem("jobs_auto_on");
  $autoTgl.checked = savedOn === "1";
  if ($autoTgl.checked) startAuto();
})();
$autoTgl.addEventListener("change", ()=>{ $autoTgl.checked ? startAuto() : stopAuto(); });
$interval.addEventListener("change", ()=>{ localStorage.setItem("jobs_auto_iv", $interval.value); if ($autoTgl.checked) startAuto(); });

function startAuto(){
  stopAuto();
  localStorage.setItem("jobs_auto_on", "1");
  autoTimer = setInterval(()=> { if (!isLoading) load(true); }, Number($interval.value || 300000));
}
function stopAuto(){
  localStorage.setItem("jobs_auto_on", "0");
  if (autoTimer) clearInterval(autoTimer);
  autoTimer = null;
}

/* ---- Interactions ---- */
$go.addEventListener("click", ()=> load(false));
$reset.addEventListener("click", () => {
  $preset.value = ""; $search.value = ""; $sort.value = "date-desc"; setActiveChip(null);
  $grid.innerHTML = ""; $summary.textContent = ""; $status.textContent = "Ready. Click Refresh to fetch.";
});
$sort.addEventListener("change", () => { if ($grid.children.length) load(true); });
$search.addEventListener("keydown", e => { if (e.key === "Enter") load(false); });
$chips.forEach(ch => ch.addEventListener('click', () => { $preset.value = ch.dataset.q; setActiveChip(ch); load(false); }));

function setActiveChip(active){ $chips.forEach(c => c.classList.toggle('active', c === active)); }

/* ---- URL builder (broad defaults for volume) ---- */
function buildUrl(){
  const parts = [];
  if ($preset.value) parts.push($preset.value);
  if ($search.value.trim()) parts.push($search.value.trim());
  const q  = parts.join(",");
  const cb = Date.now();
  const defaults = "region=au&match=loose&adz_pages=3&cj_pages=2&limit=150";
  return `${WORKER_BASE}/jobs-au?providers=${encodeURIComponent(PROVIDERS)}${q?`&q=${encodeURIComponent(q)}`:""}&${defaults}&cb=${cb}`;
}

/* ---- UI helpers ---- */
function renderSkeleton(count=8){
  $grid.innerHTML = "";
  for(let i=0;i<count;i++){
    const c = document.createElement('div');
    c.className = 'skeleton';
    c.innerHTML = `
      <div class="meta"><span class="sk-line" style="width:90px;height:20px"></span></div>
      <div class="sk-title sk-line"></div>
      <div class="row" style="gap:8px">
        <div class="sk-line" style="width:40%"></div>
        <div class="sk-line" style="width:25%"></div>
      </div>
      <div class="sk-meta sk-line"></div>
    `;
    $grid.appendChild(c);
  }
}
function timeAgo(dateStr){
  if(!dateStr) return "";
  const d = new Date(dateStr);
  if(isNaN(d)) return new Date(dateStr).toLocaleDateString('en-AU');
  const diff = Date.now() - d.getTime();
  const mins = Math.floor(diff/60000);
  if(mins < 60) return `${mins}m ago`;
  const hrs = Math.floor(mins/60);
  if(hrs < 24) return `${hrs}h ago`;
  const days = Math.floor(hrs/24);
  if(days < 7) return `${days}d ago`;
  return d.toLocaleDateString('en-AU');
}
function sortItems(items){
  const [key, dir] = $sort.value.split('-');
  const mod = dir === 'desc' ? -1 : 1;
  return items.slice().sort((a,b)=>{
    if(key === 'date'){
      const da = new Date(a.date||0).getTime();
      const db = new Date(b.date||0).getTime();
      return da < db ? mod : da > db ? -mod : 0;
    }
    if(key === 'company'){
      const ca = (a.company||'').toLowerCase();
      const cb = (b.company||'').toLowerCase();
      return ca < cb ? -mod : ca > cb ? mod : 0;
    }
    return 0;
  });
}
function stamp(){
  const d=new Date();
  const h=String(d.getHours()).padStart(2,'0');
  const m=String(d.getMinutes()).padStart(2,'0');
  return `${h}:${m}`;
}

/* ---- Loader (quiet = true for auto refresh) ---- */
async function load(quiet=false){
  if (isLoading) return;
  isLoading = true;

  const url = buildUrl();
  const ctrl = new AbortController();
  const to = setTimeout(()=>ctrl.abort(), 10000); // 10s timeout

  if (!quiet){
    $status.innerHTML = `<span class="spinner" aria-hidden="true"></span> Fetching…`;
    renderSkeleton(8);
  }

  try{
    const r = await fetch(url, { cache:"no-store", signal: ctrl.signal });
    const text = await r.text();
    let data;
    try { data = JSON.parse(text); } catch(e){ data = null; }

    // Diagnostics
    const lines = [];
    lines.push(`Request: ${url}`);
    lines.push(`HTTP: ${r.status}`);
    lines.push(`Content-Type: ${r.headers.get('content-type') || '(none)'}`);
    if (data) {
      const shape = Array.isArray(data) ? 'Array' : (data && typeof data === 'object' ? 'Object' : typeof data);
      lines.push(`JSON shape: ${shape} ${Array.isArray(data) ? `(length=${data.length})` : (data.items ? `(items.length=${(data.items||[]).length})` : '')}`);
    } else {
      lines.push('JSON parse: FAILED — showing raw body below');
      lines.push(text.slice(0, 800));
    }
    $diag.textContent = lines.join('\n');

    if (!data) {
      $status.innerHTML = `<span class="err">Couldn’t parse JSON from Worker.</span>`;
      $grid.innerHTML = '';
      return;
    }

    // Accept both shapes
    let items = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);
    if (!items.length) {
      $status.innerHTML = `<span class="warn">No jobs returned. If HTTP is 200, try changing preset/keywords.</span>`;
      $grid.innerHTML = '';
      return;
    }

    items = sortItems(items);

    $grid.innerHTML = ''; // replace results
    const count = items.length;
    const terms = [$preset.value ? 'Preset' : null, $search.value.trim() ? 'Keywords' : null].filter(Boolean).join(' + ');
    $summary.textContent = `${count} job${count!==1?'s':''} ${terms ? '• ' + terms : ''}`;
    $status.innerHTML = `<span class="ok">${quiet?'Refreshed':'Loaded'} ${count} job${count!==1?'s':''}.</span>`;
    $lastRef.textContent = `Last updated ${stamp()}`;

    for (const j of items){
      const card = document.createElement('div');
      card.className = 'card';
      const provider = (j.provider||'').toUpperCase();
      const url = escapeHTML(j.url||'');
      const title = escapeHTML(j.title||'');
      const company = escapeHTML(j.company||'');
      const location = escapeHTML(j.location||'Australia');
      const when = j.date ? timeAgo(j.date) : '';

      card.innerHTML = `
        <div class="meta"><span class="provider">${provider||'JOB'}</span></div>
        <h3 class="title"><a href="${url}" target="_blank" rel="noopener">${title}</a></h3>
        <div class="row">
          <span class="company">${company}</span>
          <span class="muted">•</span>
          <span class="muted">${location}</span>
        </div>
        <div class="row" style="margin-top:8px">
          ${when ? `<span class="pill" title="Published">${when}</span>` : ''}
        </div>
      `;
      $grid.appendChild(card);
    }
  }catch(e){
    const msg = (e && e.name === 'AbortError') ? 'Request timed out' : (e && e.message ? e.message : 'Fetch failed');
    $status.innerHTML = `<span class="err">${msg}</span>`;
    $grid.innerHTML = '';
  }finally{
    clearTimeout(to);
    isLoading = false;
  }
}

function escapeHTML(s){return (s||"").replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

/* ---- Initial load + auto ---- */
window.addEventListener("load", ()=>{
  load(false); // initial fetch
  if ($autoTgl.checked) startAuto();
});
</script>
</body>
</html>




